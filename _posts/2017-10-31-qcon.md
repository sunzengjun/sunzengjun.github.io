---
layout: post
title:  "2017qcon感想"
date:   2017-10-27 16:15:00
categories: 架构
excerpt: 寻思着这个也放到这来吧。。
---

* content
{:toc}

## 关键词:qcon

---

## 排坑：kotlin对象序列化过程参数丢失
	Qcon2017专场有许多关于架构调优、性能优化实践的讲座，可谓玲琅满目。因为最近开始接手家居商城的项目，所以我选取了电商、供应链业务的相关讲座。以下是对美丽联合集团蘑菇街技术专家分享的《蘑菇街营销业务系统演变之路》的一些思考。
	他们做到了什么？
		基于蘑菇街、美丽说融合的背景，他们团队（营销业务系统）的系统从早期的架构经历服务化阶段、融合阶段、平台化阶段演变成如下图所示的架构。
	
	
	总结来说，着力以下4个点：
		系统微服务化
		同一系统基础支持蘑菇街、美丽说、淘世界等不同平台业务
		基于业务链路的方式管理，可视化操作
		多级容灾方案实现
		
	他们怎么做的？
		在服务化阶段，他们将数据库剥离，业务系统独立，业务模块细分，前后端分离。
		在融合阶段，他们对上下层做了一些抽象，比如：面向公司层面设计执行对接客户端的规范，借助流程引擎思想把后端的部分功能模块做成了业务的链路。
		在平台化阶段，主要进行了微服务的拆分，多级容灾方案实现。
		
	他们的具体措施
		1. 应对多业务展示的业务配置 
		数据经后端处理之后，先后通过应用模板匹配，格式器解析，数据映射传递给不同的展示层。
		
		2. 添加链路执行引擎
		
		
		3. 客户端模式数据包
		
		
		4. 系统容灾架构
		通过离线计算每日数据的方式，覆盖90%的topic，避免对引擎的强依赖不稳定的问题
		
	
	上下层抽象、建立规范、面向公司层面的对接客户端的规范，设计链路
业务执行功能配置
链路层面统一增加埋点
	
	提供统一的引擎基础及标准化输出
	
	系统容灾方面：离线计算每日数据
	
	
	对我们的借鉴意义：
		美丽说和蘑菇街的合并让这家针对女性消费者的电商平台的技术人员面临了整合系统、避免重复造轮子的技术挑战。而我们所面对的场景是：针对经纪人的Lmall商城（加油站）自上线以来已经平稳运行了大半年并仍在不断迭代升级。全新的家居商城拥有着lmall的底子并且有着其独有的业务场景和逻辑。架构的设计以及优化一定是贴合项目实际的，家装商城正面临着的并且可预期的问题是：
			随着业务的迅速壮大，定制化功能增多，项目越来越臃肿
			核心业务的稳定性要求高
			维护、优化Lmall商城和家具商城的成本较大
		可借鉴的点：
			接口的可配置化设计
			不同的项目、不同的终端可能面临相似的业务场景，比如Lmall的web商品详情页和家居商城H5上的商品详情页一定有着类似的数据要求（例如商品的图片、规格），也一定有各方特有的需求数据（例如Lmall需要有链家币的支付方式）。通过接口的可配置化设计，可以让各端订阅各自需要的数据，再略微加工即可。类似的功能在二手房外网也有体现，二手外网的omnibox对房源、经纪人、小区等实体进行封装，通过封装KV, DB, REDIS等众多数据源，方便上层用户调用，上层可通过订阅实体的不同属性满足个异化需求。
			我们的商城后续可采用这样的订阅方式组织接口层次。把商品、订单等实体进行细粒度再拆分，各端订阅需要的模块。在这基础上设计格式解析器，对订阅的数据再加工并最终呈现。
			
			多级容灾系统的设计：热点数据的离线备份
			对蘑菇街的容灾备份设计，我原本是存在一些问题的。蘑菇街采用离线计算昨日的数据的方式进行备份。那么备份的时间可以控制在多长的时间段内？备份数据所占的空间是多少？数据来源是多方的，如何不影响线上功能？例如价格等敏感数据的时效性如何解决？
			和讲师沟通后发现，现在已有成熟的大数据框架离线处理数据；蘑菇街设计了一个kvstore存储备份的数据；备份的时间和备份数据所占空间和机器数量有关并且在可接受范围内；针对价格这样的敏感数据，命中降级方案后，拿到kvstore里的数据再去信息补全，同时价格模块一定是需要细粒度的拆分的，价格、库存等信息需要单独维护。
